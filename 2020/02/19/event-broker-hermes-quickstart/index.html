<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="IntroHermes 是使用 Kafka 作为消息存储和路由支持的消息代理，使用发布-订阅模式大大简化了服务之间的通信。 它是 HTTP-native，公开用于消息发布的 REST 端点，并将消息推送到订阅者 REST 端点。 Hermes 使用 HTTP 作为默认通信协议。 这意味着发布或接收消息的唯一先决条件是能够发送或使用 HTTP 请求。 Architecture  核心模块与组件">
<meta name="keywords" content="Event Broker,Hermes">
<meta property="og:type" content="article">
<meta property="og:title" content="Event Broker Hermes Quickstart">
<meta property="og:url" content="http://yoursite.com/2020/02/19/event-broker-hermes-quickstart/index.html">
<meta property="og:site_name" content="Drip throught the stone">
<meta property="og:description" content="IntroHermes 是使用 Kafka 作为消息存储和路由支持的消息代理，使用发布-订阅模式大大简化了服务之间的通信。 它是 HTTP-native，公开用于消息发布的 REST 端点，并将消息推送到订阅者 REST 端点。 Hermes 使用 HTTP 作为默认通信协议。 这意味着发布或接收消息的唯一先决条件是能够发送或使用 HTTP 请求。 Architecture  核心模块与组件">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/hermes/architecture-overview.png">
<meta property="og:updated_time" content="2020-02-20T11:16:01.810Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Event Broker Hermes Quickstart">
<meta name="twitter:description" content="IntroHermes 是使用 Kafka 作为消息存储和路由支持的消息代理，使用发布-订阅模式大大简化了服务之间的通信。 它是 HTTP-native，公开用于消息发布的 REST 端点，并将消息推送到订阅者 REST 端点。 Hermes 使用 HTTP 作为默认通信协议。 这意味着发布或接收消息的唯一先决条件是能够发送或使用 HTTP 请求。 Architecture  核心模块与组件">
<meta name="twitter:image" content="http://yoursite.com/images/hermes/architecture-overview.png">
  <link rel="canonical" href="http://yoursite.com/2020/02/19/event-broker-hermes-quickstart/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Event Broker Hermes Quickstart | Drip throught the stone</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Drip throught the stone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">40</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">14</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">25</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="fa fa-search fa-fw"></i>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/19/event-broker-hermes-quickstart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shankai">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Drip throught the stone">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Event Broker Hermes Quickstart

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-02-19 13:56:00" itemprop="dateCreated datePublished" datetime="2020-02-19T13:56:00+08:00">2020-02-19</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-20 19:16:01" itemprop="dateModified" datetime="2020-02-20T19:16:01+08:00">2020-02-20</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Messaging/" itemprop="url" rel="index"><span itemprop="name">Messaging</span></a></span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>8.2k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>7 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p><a href="https://hermes-pubsub.readthedocs.io/en/latest/" target="_blank" rel="noopener">Hermes</a> 是使用 Kafka 作为消息存储和路由支持的消息代理，使用发布-订阅模式大大简化了服务之间的通信。</p>
<p>它是 HTTP-native，公开用于消息发布的 REST 端点，并将消息推送到订阅者 REST 端点。</p>
<p>Hermes 使用 HTTP 作为默认通信协议。 这意味着发布或接收消息的唯一先决条件是能够发送或使用 HTTP 请求。</p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p><img src="/images/hermes/architecture-overview.png" alt="image"></p>
<blockquote>
<p>核心模块与组件</p>
</blockquote>
<ul>
<li>Hermes Frontend 接收来自客户端的消息</li>
<li>Hermes Consumers 发送消息到订阅者（push 模式）</li>
<li>Hermes Management 管理主题和订阅</li>
</ul>
<ul>
<li>Message Store 存储和路由消息，当前实现： Kafka</li>
<li>Metadata Store 共享元数据存储，当前实现：Zookeeper</li>
<li>Metrics Store [可选] 存储 Hermes 度量数据，当前实现：Graphite</li>
<li>Tracking Store [可选] 存储消息追踪信息，当前实现：Elasticsearch/MongoDB</li>
</ul>
<blockquote>
<p>消息流</p>
</blockquote>
<p>消息发送者发送消息到 <strong>Hermes Frontend</strong>：</p>
<ul>
<li>消息被分配唯一的 Hermes-Message-Id，可用于在系统中跟踪其路径</li>
<li>每个动作时间被计量，度量被发送到 <strong>Metrics Store</strong></li>
<li>如果主题已启用跟踪，则跟踪信息将发送到 <strong>Tracking Store</strong></li>
<li>消息被发送到 <strong>Message Store</strong></li>
</ul>
<p><strong>Hermes Consumers</strong> 发送消息给订阅者：</p>
<ul>
<li>从 <strong>Message Store</strong> 读取消息</li>
<li>每个动作时间被计量，度量被发送到 <strong>Metrics Store</strong></li>
<li>消息发送到订阅者</li>
<li>如果订阅者发生错误，<strong>Hermes Consumers</strong> 调整发送速度并重试</li>
</ul>
<blockquote>
<p>主要概念</p>
</blockquote>
<ul>
<li><p><strong>publisher</strong> 发送消息给 Hermes </p>
</li>
<li><p><strong>subscriber</strong> 希望从 Hermes  接收消息，</p>
</li>
<li><p><strong>group</strong> 是由一个发布者管理的一组主题，例如将整个主题空间划分为域和有界上下文组</p>
</li>
<li><p><strong>topic</strong> 保存相同类型的消息，定义所有存储的消息的类型、模式和持久性，订阅者可以订阅存储在主题上的消息</p>
</li>
<li><p><strong>subscription</strong> 是按每个主题创建的，保存有关已使用的消息和其他订阅者定义的属性(如最大传递速率或重试策略)的信息</p>
</li>
</ul>
<blockquote>
<p>命名约定</p>
</blockquote>
<p>主题通常使用全限定名引用，全限定名由组名和以点分隔的主题名组成。 组名可以包含任何字符-字母、数字、点。 但是，主题名称不能包含点。</p>
<p><code>Full-qualifed topic name</code> = <code>Group name</code>.<code>Topic name</code></p>
<h2 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h2><h3 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b hermes-1.3.5 https://github.com/allegro/hermes.git hermes-1.3.5</span><br></pre></td></tr></table></figure>

<h3 id="Deploy-1"><a href="#Deploy-1" class="headerlink" title="Deploy"></a>Deploy</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd hermes-1.3.5/docker</span><br><span class="line"></span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure>

<p>注意：在所有容器启动成功后，服务在实际的运行过程中，会出现一个错误，这一错误导致 <code>Hermes Consumers</code>无法收到消息。Kafka 容器后台错误信息摘要：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[2020-02-20 08:58:10,259] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:10,767] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:11,269] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:11,772] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:12,276] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:12,778] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:13,281] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:13,786] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:14,287] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:14,790] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:15,291] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:15,797] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:16,298] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br><span class="line">[2020-02-20 08:58:16,801] ERROR [KafkaApi-1001] Number of alive brokers '1' does not meet the required replication factor '3' for the offsets topic (configured via 'offsets.topic.replication.factor'). This error can be ignored if the cluster is starting up and not all brokers are up yet. (kafka.server.KafkaApis)</span><br></pre></td></tr></table></figure>

<p>出现该问题的根本原因暂时没有深入研究，目前通过增加一个配置项临时规避该错误。</p>
<p>具体操作：对 Kafka 容器内模板文件<code>/etc/confluent/docker/kafka.properties.template</code>增加<code>offsets.topic.replication.factor=1</code>这一设置，这样目标文件<code>/etc/kafka/kafka.properties</code> 在容器启动后会自动包含该设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "offsets.topic.replication.factor=1" &gt;&gt; /etc/confluent/docker/kafka.properties.template</span><br></pre></td></tr></table></figure>

<p>重启 Kafka 容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart docker_kafka_1</span><br></pre></td></tr></table></figure>

<h2 id="API-Examples"><a href="#API-Examples" class="headerlink" title="API Examples"></a>API Examples</h2><h3 id="Group-Hermes-Management"><a href="#Group-Hermes-Management" class="headerlink" title="Group (Hermes Management)"></a>Group (Hermes Management)</h3><ul>
<li>创建组</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://172.16.18.143:8090/groups \</span><br><span class="line">  -H 'Content-Type: application/json' \</span><br><span class="line">  -d '&#123;</span><br><span class="line">    "groupName": "my-group"</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>

<h3 id="Topic-Hermes-Management"><a href="#Topic-Hermes-Management" class="headerlink" title="Topic (Hermes Management)"></a>Topic (Hermes Management)</h3><ul>
<li>创建主题</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://172.16.18.143:8090/topics \</span><br><span class="line">  -H 'Content-Type: application/json' \</span><br><span class="line">  -d '&#123;</span><br><span class="line">    "name": "my-group.my-topic",</span><br><span class="line">    "description": "This is my topic",</span><br><span class="line">    "contentType": "JSON",</span><br><span class="line">    "retentionTime": &#123;</span><br><span class="line">        "duration": 1</span><br><span class="line">    &#125;,</span><br><span class="line">    "owner": &#123;</span><br><span class="line">        "source": "Plaintext",</span><br><span class="line">        "id": "MyTeam"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>

<h3 id="Subscription-Hermes-Management"><a href="#Subscription-Hermes-Management" class="headerlink" title="Subscription (Hermes Management)"></a>Subscription (Hermes Management)</h3><ul>
<li><p>创建订阅钩子端点（可以使用任何技术实现）</p>
<blockquote>
<p>本示例使用 nodejs，将以下代码保存到文件 <code>hermes-subendpoint.js</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Request Body:'</span>, req.body);</span><br><span class="line">  res.send(<span class="string">'ok'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'ok'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br><span class="line">npm install body-parser --save</span><br><span class="line"></span><br><span class="line"><span class="comment">// start </span></span><br><span class="line">node hermes-subendpoint.js</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://localhost:8081/ \</span><br><span class="line">  -H 'Content-Type: application/json' \</span><br><span class="line">  -d '&#123;</span><br><span class="line">	"a":1</span><br><span class="line">	&#125;'</span><br></pre></td></tr></table></figure>

<p>钩子端点控制台输出：<code>Request Body: { a: 1 }</code></p>
<ul>
<li>创建订阅</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://172.16.18.143:8090/topics/my-group.my-topic/subscriptions \</span><br><span class="line">  -H 'Content-Type: application/json' \</span><br><span class="line">  -d '&#123;</span><br><span class="line">    "topicName": "my-group.my-topic",</span><br><span class="line">    "name": "my-Subscription", </span><br><span class="line">    "description": "This is my subscription",</span><br><span class="line">    "endpoint": "http://172.16.18.1:8081/", </span><br><span class="line">    "owner": &#123;</span><br><span class="line">        "source": "Plaintext",</span><br><span class="line">        "id": "MyTeam"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>

<h3 id="Publish-Hermes-Frontend"><a href="#Publish-Hermes-Frontend" class="headerlink" title="Publish (Hermes-Frontend)"></a>Publish (Hermes-Frontend)</h3><ul>
<li>发布消息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://172.16.18.143:8080/topics/my-group.my-topic \</span><br><span class="line">  -H 'Content-Type: application/json' \</span><br><span class="line">  -d '&#123;</span><br><span class="line">    "message": "Hello world!",</span><br><span class="line">    "more": "1112223334444555"</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>

<p>钩子端点控制台输出：</p>
<p><code>Request Body: { message: &#39;Hello world!&#39;, more: &#39;1112223334444555&#39; }</code></p>
<p>（待续）</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Event-Broker/" rel="tag"># Event Broker</a>
            
              <a href="/tags/Hermes/" rel="tag"># Hermes</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/02/18/event-broker-nakadi-quickstart/" rel="next" title="Event Broker Nakadi Quickstart">
                  <i class="fa fa-chevron-left"></i> Event Broker Nakadi Quickstart
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/02/20/vagrant-quickstart/" rel="prev" title="Vagrant 笔记">
                  Vagrant 笔记 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Intro"><span class="nav-number">1.</span> <span class="nav-text">Intro</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Architecture"><span class="nav-number">2.</span> <span class="nav-text">Architecture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deploy"><span class="nav-number">3.</span> <span class="nav-text">Deploy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Download"><span class="nav-number">3.1.</span> <span class="nav-text">Download</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deploy-1"><span class="nav-number">3.2.</span> <span class="nav-text">Deploy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-Examples"><span class="nav-number">4.</span> <span class="nav-text">API Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Group-Hermes-Management"><span class="nav-number">4.1.</span> <span class="nav-text">Group (Hermes Management)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Topic-Hermes-Management"><span class="nav-number">4.2.</span> <span class="nav-text">Topic (Hermes Management)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Subscription-Hermes-Management"><span class="nav-number">4.3.</span> <span class="nav-text">Subscription (Hermes Management)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Publish-Hermes-Frontend"><span class="nav-number">4.4.</span> <span class="nav-text">Publish (Hermes-Frontend)</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="shankai">
  <p class="site-author-name" itemprop="name">shankai</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/shankai" title="GitHub &rarr; https://github.com/shankai" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:shankai.kvn@gmail.com" title="E-Mail &rarr; mailto:shankai.kvn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shankai</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">46k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">41 分钟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.1</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  








  <script src="/js/local-search.js?v=7.4.1"></script>














  

  

  

</body>
</html>
